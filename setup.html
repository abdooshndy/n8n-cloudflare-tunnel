<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Easy Setup | Ø¥Ø¹Ø¯Ø§Ø¯ n8n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #f5f7ff;
        }

        .radio-option.selected {
            border-color: #667eea;
            background: #f5f7ff;
        }

        .radio-option input[type="radio"] {
            margin-left: 10px;
        }

        .advanced {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .output {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
            display: none;
        }

        .output.show {
            display: block;
        }

        .output pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
            direction: ltr;
            text-align: left;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .steps {
            margin-top: 20px;
        }

        .step {
            padding: 15px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .step-num {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸš€ n8n Easy Setup</h1>
        <p class="subtitle">Ø¥Ø¹Ø¯Ø§Ø¯ Ø³Ø±ÙŠØ¹ ÙˆØ³Ù‡Ù„ | Quick & Easy Configuration</p>

        <div id="form-section">
            <div class="form-group">
                <label>ğŸ‘¤ Username (Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)</label>
                <input type="text" id="username" value="admin" placeholder="admin">
            </div>

            <div class="form-group">
                <label>ğŸ”’ Password (ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±)</label>
                <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©">
            </div>

            <div class="form-group">
                <label>ğŸŒ Timezone (Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©)</label>
                <select id="timezone">
                    <option value="Africa/Cairo">Africa/Cairo (Ù…ØµØ±)</option>
                    <option value="Asia/Riyadh">Asia/Riyadh (Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©)</option>
                    <option value="Asia/Dubai">Asia/Dubai (Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª)</option>
                    <option value="Asia/Kuwait">Asia/Kuwait (Ø§Ù„ÙƒÙˆÙŠØª)</option>
                    <option value="Asia/Baghdad">Asia/Baghdad (Ø§Ù„Ø¹Ø±Ø§Ù‚)</option>
                    <option value="Europe/Istanbul">Europe/Istanbul (ØªØ±ÙƒÙŠØ§)</option>
                </select>
            </div>

            <div class="form-group">
                <label>ğŸ”— Tunnel Type (Ù†ÙˆØ¹ Ø§Ù„Ø§ØªØµØ§Ù„)</label>
                <div class="radio-group">
                    <div class="radio-option selected" onclick="selectTunnel('quick')">
                        <input type="radio" name="tunnel" value="quick" checked>
                        <strong>Quick Tunnel</strong><br>
                        <small>Ù…Ø¬Ø§Ù†ÙŠ - Ø¨Ø¯ÙˆÙ† domain</small>
                    </div>
                    <div class="radio-option" onclick="selectTunnel('named')">
                        <input type="radio" name="tunnel" value="named">
                        <strong>Named Tunnel</strong><br>
                        <small>Ù…Ø¹ domain Ø®Ø§Øµ</small>
                    </div>
                </div>
            </div>

            <div id="advanced-section" class="advanced">
                <div class="form-group">
                    <label>ğŸ”‘ Cloudflare Token</label>
                    <input type="text" id="cf-token" placeholder="eyJhIjoixxxxxx...">
                </div>
                <div class="form-group">
                    <label>ğŸŒ Domain</label>
                    <input type="text" id="domain" placeholder="n8n.yourdomain.com">
                </div>
            </div>

            <button class="btn btn-primary" onclick="generateConfig()">
                âœ… Generate Configuration | ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>

        <div id="output-section" class="output">
            <div class="alert alert-success">
                âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!
            </div>

            <div class="alert alert-info">
                <strong>ğŸš€ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:</strong><br>
                1. Ø§Ø¶ØºØ· Ø²Ø± <strong>"Download Configuration"</strong> Ø£Ø¯Ù†Ø§Ù‡<br>
                2. Ø§Ø­ÙØ¸ Ù…Ù„Ù <strong>.env</strong> ÙÙŠ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹<br>
                3. Ø§Ø°Ù‡Ø¨ Ù„Ù„Ù…Ø¬Ù„Ø¯ ÙˆØ´ØºÙ‘Ù„ Ù…Ù„Ù <strong>Start-n8n.bat</strong>
            </div>

            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="downloadEnv()" style="background: #28a745;">
                    ğŸ“¥ Download Configuration (ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)
                </button>
            </div>

            <hr style="margin: 20px 0;">

            <div class="steps">
                <div class="step">
                    <span class="step-num">1</span>
                    <strong>Ø£Ùˆ Ø§Ù†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£Ø¯Ù†Ø§Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹</strong>
                </div>
                <div class="step">
                    <span class="step-num">2</span>
                    <strong>Ø§ÙØªØ­ Notepad ÙˆØ£Ù„ØµÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</strong>
                </div>
                <div class="step">
                    <span class="step-num">3</span>
                    <strong>Ø§Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³Ù… <code>.env</code> ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯</strong>
                </div>
                <div class="step">
                    <span class="step-num">4</span>
                    <strong>Ø´ØºÙ‘Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø£Ø¯Ù†Ø§Ù‡ ÙÙŠ PowerShell</strong>
                </div>
            </div>

            <h3 style="margin-top: 20px; margin-bottom: 10px;">ğŸ“„ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù .env</h3>
            <pre id="env-content"></pre>

            <h3 style="margin-top: 20px; margin-bottom: 10px;">ğŸ’» Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
            <pre id="commands"></pre>

            <button class="btn btn-primary" onclick="copyToClipboard('env-content')">
                ğŸ“‹ Copy .env Content
            </button>
        </div>
    </div>

    <script>
        function selectTunnel(type) {
            const options = document.querySelectorAll('.radio-option');
            options.forEach(opt => opt.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            // Explicitly check the radio button
            const radio = event.currentTarget.querySelector('input[type="radio"]');
            if (radio) radio.checked = true;

            const advanced = document.getElementById('advanced-section');
            if (type === 'named') {
                advanced.style.display = 'block';
            } else {
                advanced.style.display = 'none';
            }
        }

        function generateConfig() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const timezone = document.getElementById('timezone').value;
            const tunnelType = document.querySelector('input[name="tunnel"]:checked').value;

            if (!password) {
                alert('âš ï¸ Please enter a password! | ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!');
                return;
            }

            let envContent = `# Generated by n8n Easy Setup\n`;
            envContent += `N8N_USER=${username}\n`;
            envContent += `N8N_PASSWORD=${password}\n`;
            envContent += `TIMEZONE=${timezone}\n\n`;

            let commands = `# 1. Download Docker images (first time only)\n`;
            commands += `.\\download-images.ps1\n\n`;

            if (tunnelType === 'quick') {
                envContent += `# Quick Tunnel Mode\n`;
                envContent += `N8N_HOST=quick-tunnel\n`;
                envContent += `WEBHOOK_URL=http://localhost\n`;
                commands += `# 2. Start n8n with Quick Tunnel\n`;
                commands += `docker-compose up -d\n\n`;
                commands += `# 3. Get URL (after 10 seconds)\n`;
                commands += `.\\get-url.bat\n`;
            } else {
                const token = document.getElementById('cf-token').value;
                const domain = document.getElementById('domain').value;

                if (!token || !domain) {
                    alert('âš ï¸ Token and Domain required! | Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ§Ù„Ù†Ø·Ø§Ù‚ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†!');
                    return;
                }

                envContent += `# Named Tunnel Mode\n`;
                envContent += `N8N_HOST=${domain}\n`;
                envContent += `WEBHOOK_URL=https://${domain}\n`;
                envContent += `CLOUDFLARE_TUNNEL_TOKEN=${token}\n`;
                commands += `# 2. Start n8n with Named Tunnel\n`;
                commands += `docker-compose up -d\n\n`;
                commands += `# 3. Access at:\n`;
                commands += `# https://${domain}\n`;
            }

            document.getElementById('env-content').textContent = envContent;
            document.getElementById('commands').textContent = commands;
            document.getElementById('output-section').classList.add('show');
            document.getElementById('form-section').style.display = 'none';
        }

        function downloadEnv() {
            const content = document.getElementById('env-content').textContent;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'n8n.env';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù .env!\n\nØ¶Ø¹Ù‡ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù…Ø¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.\n\nâœ… .env file downloaded!\n\nPlace it in the same folder with project files.');
        }

        function downloadStarter() {
            const tunnelType = document.querySelector('input[name="tunnel"]:checked').value;
            let profile = tunnelType === 'quick' ? 'quick-tunnel' : 'named-tunnel';

            let starterContent = `@echo off
REM ========================================================
REM n8n One-Click Launcher
REM ========================================================
chcp 65001 >nul
cd /d "%~dp0"
cls

echo ========================================================
echo n8n Launcher
echo ========================================================
echo.

:CHECK_CONFIG
REM 0. Auto-Rename Config
if exist "n8n.env" (
    echo [INFO] Found n8n.env, updating configuration...
    move /Y "n8n.env" ".env" >nul
)
if exist "env" (
    echo [INFO] Found env file, updating configuration...
    move /Y "env" ".env" >nul
)

REM 1. Check Configuration
if not exist ".env" (
    echo [ERROR] Configuration file .env not found!
    echo.
    echo 1. Opening setup page...
    start "" "setup.html"
    echo.
    echo 2. Please fill data and click "Download Configuration"
    echo 3. Save the .env file in this folder
    echo.
    echo [WAITING] Waiting for .env file...
    echo.
    pause
    cls
    echo ========================================================
    echo n8n Launcher
    echo ========================================================
    echo.
    goto CHECK_CONFIG
)

echo [OK] Configuration found (.env)
echo.

REM 2. Check Docker
echo [INFO] Checking Docker...
docker --version >nul 2>&1
if errorlevel 1 (
    echo [ERROR] Docker Desktop is NOT running!
    echo Please start Docker Desktop first.
    pause
    exit /b
)

REM Check for docker compose command (v1 vs v2)
docker compose version >nul 2>&1
if not errorlevel 1 (
    set DOCKER_COMPOSE_CMD=docker compose
) else (
    set DOCKER_COMPOSE_CMD=docker-compose
)

echo [OK] Using: %DOCKER_COMPOSE_CMD%
echo.

REM 3. Check Images
echo [INFO] Checking images...

%DOCKER_COMPOSE_CMD% images -q n8n >nul 2>&1
if errorlevel 1 (
    REM Image might be missing, check for offline package
    if exist "n8n-images.tar.gz" (
        echo [INFO] Found offline package: n8n-images.tar.gz
        echo [INFO] Loading images locally...
        tar -xzf n8n-images.tar.gz -O | docker load
    ) else (
        echo [INFO] Building image locally - Internet required...
        echo This may take 5-10 minutes...
        %DOCKER_COMPOSE_CMD% build --no-cache
        if errorlevel 1 (
            echo [ERROR] Build failed! Check internet connection.
            pause
            exit /b
        )
    )
) else (
    echo [OK] Image ready.
)

REM 4. Start Container
echo.
echo [INFO] STARTING N8N...
echo.

%DOCKER_COMPOSE_CMD% up -d

if errorlevel 1 (
    echo [ERROR] Error starting containers.
    pause
    exit /b
)

echo [OK] System is running!
echo.

REM 5. Display URL
findstr /C:"N8N_HOST=quick-tunnel" .env >nul
if not errorlevel 1 (
    echo [INFO] Getting Quick Tunnel URL...
    echo Please wait...
    timeout /t 10 /nobreak >nul
    
    echo ========================================================
    echo ğŸŒ Your n8n URL:
    echo ========================================================
    docker logs n8n-bundled 2>&1 | findstr "https://"
    echo ========================================================
) else (
    echo ========================================================
    echo âœ… Ready! Access via your domain.
    echo ========================================================
)

echo.
echo Press any key to close...
pause >nul
`;

            const blob = new Blob([starterContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'start-n8n.bat';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù start-n8n.bat!\n\nØ¶Ø¹Ù‡ Ù…Ø¹ Ù…Ù„Ù .env Ø«Ù…:\n1. Ø§Ù†Ù‚Ø± Ù†Ù‚Ø±Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹ Ø¹Ù„Ù‰ start-n8n.bat\n2. Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ\n3. Ø§Ø³ØªÙ…ØªØ¹!\n\nâœ… Downloaded start-n8n.bat!\n\nPlace it with .env then:\n1. Double-click start-n8n.bat\n2. Wait for completion\n3. Enjoy!');
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… Copied! | ØªÙ… Ø§Ù„Ù†Ø³Ø®!');
            });
        }
    </script>

    <div style="text-align: center; margin-top: 30px; color: #666; font-size: 12px;">
        <p>v1.3.0 Hybrid Edition</p>
        <p><a href="https://github.com/abdooshndy/n8n-cloudflare-tunnel" target="_blank"
                style="color: #667eea; text-decoration: none;">View on GitHub</a></p>
    </div>
</body>

</html>